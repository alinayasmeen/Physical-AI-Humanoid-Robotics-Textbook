# لیب 2: لیڈار پوائنٹ کلاؤڈ پروسیسنگ

**موڈیول**: 3 - پرچیپشن اور سینسر
**مدت**: 90 منٹ
**پریشانی**: متوسط

## اہداف

ROS 2 میں لیڈار پوائنٹ کلاؤڈ ڈیٹا کو عمل کریں، گراؤنڈ پلین ہٹانے، رکاوٹ کلاسٹرنگ، اور فاصلہ فلٹرنگ کو نافذ کریں. آپ PointCloud2 میسجز اور numpy اریز کے ساتھ کام کرنا سیکھیں گے تاکہ 3D ڈیٹا کی کارآمد پروسیسنگ ہو سکے.

## ضروریات

- موڈیول 1 اور 2 مکمل
- لیب 1 (امیج سبسکرائبر) مکمل
- ROS 2 ہمبل کے ساتھ اوبنٹو 22.04
- `sensor_msgs_py` پیکج (ROS 2 کے ساتھ شامل)

## سیکھنے کے نتائج

اس لیب کو مکمل کرنے کے بعد، آپ:

1. PointCloud2 میسجز کو سبسکرائب کریں گے اور numpy اریز میں تبدیل کریں گے
2. اونچائی کے تھریشولڈنگ کا استعمال کرتے ہوئے گراؤنڈ پلین ہٹانے کو نافذ کریں گے
3. رکاوٹ ڈیٹیکشن کے لیے فاصلہ کے ذریعے پوائنٹس کو فلٹر کریں گے
4. پوائنٹ کلاؤڈ ڈیٹا پر اعداد و شمار کا حساب کریں گے

---

## سیٹ اپ

### 1. انسٹالیشن کی تصدیق کریں

```bash
# چیک کریں کہ sensor_msgs_py دستیاب ہے
python3 -c "import sensor_msgs_py.point_cloud2 as pc2; print('OK')"

# NumPy چیک کریں
python3 -c "import numpy; print(f'NumPy: {numpy.__version__}')"
```

### 2. لیب ڈائریکٹری میں جائیں

```bash
cd ~/ros2_ws/src
cp -r /path/to/labs/module-03/lab-02-lidar-processing .
cd lab-02-lidar-processing
```

### 3. لیڈار کے ساتھ سیمولیشن لانچ کریں

```bash
# ٹرمنل 1: لیڈار والے روبوٹ کے ساتھ گیزبو لانچ کریں
ros2 launch gazebo_ros gazebo.launch.py

# ٹرمنل 2: لیڈار ٹاپک کی تصدیق کریں
ros2 topic list | grep -E "(lidar|points|scan)"
ros2 topic hz /lidar/points
```

---

## لیب اسٹیپس

### اسٹیپ 1: پوائنٹ کلاؤڈ کی ساخت سمجھیں (15 منٹ)

PointCloud2 میسج کی ساخت کا جائزہ لیں:

```bash
# میسج کی وضاحت دیکھیں
ros2 interface show sensor_msgs/msg/PointCloud2

# ایک میسج ایکو کریں
ros2 topic echo /lidar/points --once
```

`starter/lidar_processor.py` کھولیں اور ساخت کا جائزہ لیں.

### اسٹیپ 2: PointCloud2 کو Numpy میں تبدیل کریں (20 منٹ)

TODO 1 مکمل کریں - آنے والے پوائنٹ کلاؤڈز کو numpy اریز میں تبدیل کریں:

```python
# کارآمد تبدیلی کے لیے sensor_msgs_py استعمال کریں
import sensor_msgs_py.point_cloud2 as pc2

# کال بیک میں:
points_list = []
for point in pc2.read_points(msg, skip_nans=True):
    points_list.append([point[0], point[1], point[2]])
cloud = np.array(points_list)
```

### اسٹیپ 3: گراؤنڈ پلین ہٹانے کو نافذ کریں (20 منٹ)

TODO 2 مکمل کریں - اونچائی کی بنیاد پر گراؤنڈ پوائنٹس ہٹائیں:

```python
def remove_ground(points, ground_height=-0.3):
    """گراؤنڈ_ہائٹ تھریشولڈ سے نیچے کے پوائنٹس ہٹائیں"""
    mask = points[:, 2] > ground_height
    return points[mask]
```

مختلف تھریشولڈ ویلیوز (-0.5، -0.3، 0.0) کے ساتھ ٹیسٹ کریں.

### اسٹیپ 4: فاصلہ فلٹرنگ نافذ کریں (20 منٹ)

TODO 3 مکمل کریں - صرف قریبی رکاوٹس رکھیں:

```python
def filter_by_distance(points, min_dist=0.5, max_dist=10.0):
    """سینسر سے فاصلہ کے دائرے میں پوائنٹس رکھیں"""
    distances = np.sqrt(points[:, 0]**2 + points[:, 1]**2)
    mask = (distances > min_dist) & (distances < max_dist)
    return points[mask]
```

### اسٹیپ 5: اعداد و شمار کا حساب کریں (10 منٹ)

TODO 4 مکمل کریں - مفید اعداد و شمار کا حساب کریں:

```python
def compute_statistics(points):
    """پوائنٹ کلاؤڈ اعداد و شمار کا حساب کریں"""
    return {
        'count': len(points),
        'min_distance': np.min(np.linalg.norm(points[:, :2], axis=1)),
        'max_height': np.max(points[:, 2]),
        'centroid': np.mean(points, axis=0)
    }
```

### اسٹیپ 6: تصدیق اور موازنہ کریں (5 منٹ)

```bash
# اپنے نفاذ چلائیں
python3 starter/lidar_processor.py

# حل کے ساتھ موازنہ کریں
python3 solution/lidar_processor.py

# توثیق چلائیں
python3 validate.py
```

---

## ڈلیوریبلز

1. **کام کرتا ہوا کوڈ**: مکمل `starter/lidar_processor.py`
2. **اعداد و شمار کا آؤٹ پٹ**: فلٹرڈ پوائنٹ کاؤنٹس دکھانے والا لاگ
3. **ریفلیکشن جوابات**: ذیل کے سوالات کا جواب دیں

---

## ریفلیکشن سوالات

1. **گراؤنڈ ہٹانے کے لیے اونچائی تھریشولڈ سے نیچے کے پوائنٹس کیوں ہٹائیں؟**
   - غور کریں: گراؤنڈ پلین کا اثبات، سادگی بمقابلہ درستی

2. **اونچائی بیسڈ گراؤنڈ ہٹانے کی کیا حدود ہیں؟**
   - سوچیں: ریمپس، کربس، غیر مساوی زمین

3. **آپ رکاوٹس بمقابلہ خالی جگہ کیسے ڈیٹیکٹ کریں گے؟**
   - غور کریں: کلاسٹرنگ، آکوپنسی گرڈس

4. **بہت گھنے پوائنٹ کلاؤڈس کے ساتھ کیا ہوتا ہے (>100k پوائنٹس)؟**
   - سوچیں: پروسیسنگ ٹائم، ڈاؤن سیمپلنگ کی حکمت عملیاں

---

## توثیق

```bash
python3 validate.py
```

متوقع آؤٹ پٹ:

```
[PASS] lidar_processor.py موجود ہے
[PASS] درست پائی تھن نحو
[PASS] PointCloud2 امپورٹ موجود ہے
[PASS] read_points فنکشن استعمال کیا گیا
[PASS] گراؤنڈ ہٹانے نافذ کیا گیا
[PASS] فاصلہ فلٹرنگ نافذ کی گئی
لیب 2 مکمل!
```

---

## توسیع چیلنجز

1. **voxel ڈاؤن سیمپلنگ**: ڈھانچہ برقرار رکھتے ہوئے پوائنٹ کثافت کم کریں
2. **RANSAC گراؤنڈ پلین**: مضبوط گراؤنڈ ڈیٹیکشن کے لیے RANSAC استعمال کریں
3. **کلاسٹرنگ**: قریبی پوائنٹس کو رکاوٹ کلاسٹرز میں گروپ کریں
4. **فلٹرڈ کلاؤڈ شائع کریں**: نئے ٹاپک پر عمل کردہ کلاؤڈ آؤٹ پٹ کریں

---

## اگلے اقدامات

- **لیب 3**: سینسر فیوژن - کیمرہ اور لیڈار ڈیٹا کو ضم کریں
- **لیسن 3**: پرچیپشن پائپ لائنز - اوبجیکٹ ڈیٹیکشن اور ٹریکنگ