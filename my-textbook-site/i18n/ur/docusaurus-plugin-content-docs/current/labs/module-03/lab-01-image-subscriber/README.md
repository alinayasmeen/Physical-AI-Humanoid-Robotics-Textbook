# لیب 1: امیج سبسکرائبر اور بنیادی پروسیسنگ

**موڈیول**: 3 - پرچیپشن اور سینسر
**مدت**: 60 منٹ
**پریشانی**: مبتدی

## اہداف

ایک ROS 2 نوڈ بنائیں جو کیمرہ امیجز کو سبسکرائب کرتا ہے، انہیں OpenCV کا استعمال کرتے ہوئے عمل کرتا ہے، اور نتائج شائع کرتا ہے. آپ کنارہ ڈیٹیکشن، رنگ کی فلٹرنگ نافذ کریں گے اور امیج ٹرانسپورٹ پائپ لائن سیکھیں گے.

## ضروریات

- موڈیول 1 (ROS 2 بنیادیات) مکمل
- موڈیول 2 (کیمرہ سینسرز کے ساتھ سیمولیشن بنیادیات) مکمل
- ROS 2 ہمبل کے ساتھ اوبنٹو 22.04 انسٹال
- OpenCV 4.x انسٹال (`pip install opencv-python`)
- cv_bridge پیکج انسٹال (`ros-humble-cv-bridge`)

## سیکھنے کے نتائج

اس لیب کو مکمل کرنے کے بعد، آپ:

1. sensor_msgs/Image کا استعمال کرتے ہوئے ROS 2 امیج ٹاپکس کو سبسکرائب کریں گے
2. ROS 2 امیج میسجز اور OpenCV اریز کے درمیان تبدیل کریں گے
3. بنیادی امیج پروسیسنگ آپریشنز (گرے اسکیل، دھندلا، کنارے) لاگو کریں گے
4. ROS 2 ٹاپکس پر عمل کردہ امیجز کو دوبارہ شائع کریں گے

---

## سیٹ اپ

### 1. انسٹالیشن کی تصدیق کریں

```bash
# OpenCV ورژن چیک کریں
python3 -c "import cv2; print(f'OpenCV version: {cv2.__version__}')"

# cv_bridge دستیاب ہے چیک کریں
ros2 pkg list | grep cv_bridge

# sensor_msgs چیک کریں
ros2 interface show sensor_msgs/msg/Image
```

### 2. لیب ڈائریکٹری میں جائیں

```bash
cd ~/ros2_ws/src
cp -r /path/to/labs/module-03/lab-01-image-subscriber .
cd lab-01-image-subscriber
```

### 3. کیمرہ کے ساتھ سیمولیشن لانچ کریں

کیمرہ سینسر کے ساتھ ایک روبوٹ کے ساتھ گیزبو شروع کریں:

```bash
# ٹرمنل 1: کیمرہ والے روبوٹ کے ساتھ گیزبو لانچ کریں
ros2 launch gazebo_ros gazebo.launch.py

# ٹرمنل 2: چیک کریں کہ کیمرہ ٹاپک شائع ہو رہا ہے
ros2 topic list | grep camera
ros2 topic hz /camera/image_raw
```

---

## لیب اسٹیپس

### اسٹیپ 1: اسٹارٹر کوڈ کو سمجھیں (10 منٹ)

`starter/image_subscriber.py` کھولیں اور اس کی ساخت کا جائزہ لیں:

```bash
cat starter/image_subscriber.py
```

اسٹارٹر کوڈ فراہم کرتا ہے:

- بنیادی ROS 2 نوڈ کی ساخت
- خالی کال بیک فنکشن
- آپ کے نفاذ کے لیے ٹوڈو مارکر

**آپ کا کام**: نوڈ کو کام کرتا بنانے کے لیے ٹوڈو مکمل کریں.

### اسٹیپ 2: امیج تبدیلی نافذ کریں (15 منٹ)

`image_callback` میتھڈ میں، ROS 2 امیج کو OpenCV فارمیٹ میں تبدیل کریں:

```python
# TODO 1: ROS امیج کو OpenCV فارمیٹ میں تبدیل کریں
cv_image = self.bridge.imgmsg_to_cv2(msg, 'bgr8')
```

اپنی تبدیلی کو ٹیسٹ کریں:

```bash
# ٹرمنل 1: اپنا نوڈ چلائیں
python3 starter/image_subscriber.py

# ٹرمنل 2: لاگ آؤٹ پٹ کے لیے چیک کریں
ros2 topic echo /camera/image_raw --no-arr | head -20
```

### اسٹیپ 3: امیج پروسیسنگ شامل کریں (15 منٹ)

پروسیسنگ پائپ لائن نافذ کریں:

1. **گرے اسکیل تبدیلی**: 3 چینلز کو 1 میں کم کریں
2. **گاؤسین دھندلا**: 5x5 کرنل کے ساتھ نوائز کم کریں
3. **کینی کنارہ ڈیٹیکشن**: 50، 150 کے تھریشولڈز کے ساتھ کنارے تلاش کریں

```python
# TODO 2: امیج کو عمل کریں
gray = cv2.cvtColor(cv_image, cv2.COLOR_BGR2GRAY)
blurred = cv2.GaussianBlur(gray, (5, 5), 0)
edges = cv2.Canny(blurred, 50, 150)
```

### اسٹیپ 4: عمل کردہ امیج شائع کریں (10 منٹ)

عمل کردہ امیج کو دوبارہ ROS 2 فارمیٹ میں تبدیل کریں اور شائع کریں:

```python
# TODO 3: کناروں کو BGR میں تبدیل کریں اور شائع کریں
edges_bgr = cv2.cvtColor(edges, cv2.COLOR_GRAY2BGR)
out_msg = self.bridge.cv2_to_imgmsg(edges_bgr, 'bgr8')
out_msg.header = msg.header  # ٹائم سٹیمپ محفوظ کریں
self.processed_pub.publish(out_msg)
```

شائع ہونے کی تصدیق کریں:

```bash
# چیک کریں کہ آپ کا عمل کردہ ٹاپک شائع ہو رہا ہے
ros2 topic list | grep processed
ros2 topic hz /camera/image_processed
```

### اسٹیپ 5: نتائج وژولائز کریں (5 منٹ)

خام اور عمل کردہ امیجز دونوں دیکھنے کے لیے rqt_image_view استعمال کریں:

```bash
# ٹرمنل: امیج ویور لانچ کریں
ros2 run rqt_image_view rqt_image_view
```

 موازنہ کرنے کے لیے `/camera/image_raw` اور `/camera/image_processed` منتخب کریں.

### اسٹیپ 6: حل کے ساتھ موازنہ کریں (5 منٹ)

مکمل حل کا جائزہ لیں:

```bash
# اپنے نفاذ کا موازنہ کریں
diff starter/image_subscriber.py solution/image_subscriber.py

# حل چلائیں
python3 solution/image_subscriber.py
```

---

## ڈلیوریبلز

1. **کام کرتا ہوا نوڈ**: `starter/image_subscriber.py` جو:

   - `/camera/image_raw` کو سبسکرائب کرتا ہے
   - OpenCV فارمیٹ میں تبدیل کرتا ہے
   - کنارہ ڈیٹیکشن لاگو کرتا ہے
   - `/camera/image_processed` پر شائع کرتا ہے

2. **اسکرین شاٹ**: دونوں طرف سے دیکھنے والی فریم کو دکھانے والی امیج

3. **جوابات**: ذیل کے ریفلیکشن سوالات مکمل کریں

---

## ریفلیکشن سوالات

1. **ہم کنارہ ڈیٹیکشن سے پہلے گرے اسکیل میں کیوں تبدیل کرتے ہیں؟**
   - غور کریں: کمپیوٹیشن لاگت، کینی الگورتھم کی ضروریات، معلومات کا مواد

2. **اگر آپ کینی تھریشولڈز (50، 150) تبدیل کریں تو کیا ہوتا ہے؟**
   - آزمائیں: (10، 50)، (100، 200)، (150، 250)
   - مشاہدہ کریں: کنارہ سینسیٹیویٹی، نوائز ہینڈلنگ

3. **ہم شائع کرتے وقت اصل میسج ہیڈر کیوں محفوظ کرتے ہیں؟**
   - سوچیں: ٹائم سٹیمپ مطابقت، فریم_آئی ڈی، نیچے کی طرف استعمال کنندگان

4. **آپ اس نوڈ کو صرف افقی کنارے ڈیٹیکٹ کرنے کے لیے کیسے تبدیل کریں گے؟**
   - غور کریں: سوبیل آپریٹر، کرنل جہت

---

## توثیق

اپنی لیب کے مکمل ہونے کی تصدیق کے لیے توثیق اسکرپٹ چلائیں:

```bash
python3 validate.py
```

متوقع آؤٹ پٹ:

```
[PASS] starter/ میں image_subscriber.py موجود ہے
[PASS] درست پائی تھن نحو
[PASS] cv_bridge امپورٹ موجود ہے
[PASS] امیج سبسکرائبر تخلیق کیا گیا
[PASS] امیج پبلشر تخلیق کیا گیا
[PASS] imgmsg_to_cv2 تبدیلی استعمال کی گئی
[PASS] cv2_to_imgmsg تبدیلی استعمال کی گئی
لیب 1 مکمل!
```

---

## مسئلہ حل

### ImportError: 'cv_bridge' نام کا کوئی ماڈیول نہیں

```bash
# cv_bridge انسٹال کریں
sudo apt update
sudo apt install ros-humble-cv-bridge python3-opencv
```

### کوئی کیمرہ ٹاپک دستیاب نہیں

```bash
# چیک کریں کہ سیمولیشن چل رہا ہے
ros2 node list

# اگر کوئی کیمرہ نہ ہو، تو کیمرہ والا سادہ روبوٹ اسپون کریں
ros2 run gazebo_ros spawn_entity.py -entity camera_robot -file /path/to/robot.sdf
```

### امیج سیاہ دکھائی دیتا ہے

- انکوڈنگ مماثل ہے چیک کریں: رنگ کے لیے 'bgr8' استعمال کریں، گرے اسکیل کے لیے 'mono8'
- یقینی بنائیں کہ امیج ڈیٹا تمام صفر نہیں ہے
- چیک کریں کہ کیمرہ کچھ چیز کی طرف اشارہ کر رہا ہے

### فریم کی شرح بہت سست ہے

- سیمولیشن میں امیج ریزولوشن کم کریں
- ہر فریم کے بجائے ہر Nویں فریم کو عمل کریں
- بھاری پروسیسنگ کے لیے تھریڈنگ استعمال کریں

---

## توسیع چیلنجز

1. **رنگ کی ڈیٹیکشن**: کناروں کے بجائے سرخ اشیاء ڈیٹیکٹ کرنے کے لیے نوڈ تبدیل کریں
2. **ریجن آف انٹریسٹ**: صرف امیج کا نچلا نصف عمل کریں (لین فالو کرنے کے لیے)
3. **ملٹی ٹاپک**: ڈیپتھ امیج کو سبسکرائب کریں اور کلر امیج پر اوور لے کریں
4. **پیرامیٹر**: تھریشولڈز کو ROS 2 پیرامیٹر کے ذریعے قابل ترتیب بنائیں

---

## اگلے اقدامات

اس لیب کو مکمل کرنے کے بعد، آگے بڑھیں:

- **لیب 2**: لیڈار پروسیسنگ - پوائنٹ کلاؤڈ ڈیٹا کے ساتھ کام کریں
- **لیسن 2**: ملٹی سینسر انٹیگریشن - مختلف سینسر کی اقسام کو سمجھیں