# مینی پروجیکٹ 2: ارم کنٹرولر

**مدت**: 3-4 گھنٹے
**موڈیول**: موڈیول 1 - روبوٹک نروس سسٹم
**ضروریات**: لیبز 1-4 مکمل

## جائزہ

لیب 4 سے اپنے 2-DOF URDF ماڈل کا استعمال کرتے ہوئے ایک کی بورڈ کنٹرولڈ ارم سسٹم بنائیں. یہ پروجیکٹ URDF ماڈلنگ، ROS 2 کنٹرول، اور انٹرایکٹو ان پٹ ہینڈلنگ کو ضم کرتا ہے.

## اہداف

ایک مکمل ارم کنٹرول سسٹم بنائیں:

- URDF ماڈل لوڈ کریں
- جوائنٹ کنٹرول کے لیے کی بورڈ ٹیلی آپ
- جوائنٹ حدود کی پابندی
- ہنگامی بندش کی خصوصیت

## سسٹم معماری

```
┌──────────────┐    /joint_commands    ┌──────────────┐
│   کی بورڈ    │ ──────────────────▶   │   جوائنٹ     │
│   ٹیلی آپ    │                       │   کنٹرولر   │
│   نوڈ        │                       │   نوڈ        │
└──────────────┘                       └──────────────┘
                                              │
                                              ▼
                                       /joint_states
                                              │
                                              ▼
                                       ┌──────────────┐
                                       │   RViz       │
                                       │   ڈسپلے    │
                                       └──────────────┘
```

## ضروریات

### 1. جوائنٹ کنٹرولر نوڈ

کمانڈز وصول کرتا ہے اور جوائنٹ اسٹیٹس شائع کرتا ہے:

```python
# سبسکرائب کریں: /joint_commands (Float64MultiArray)
# شائع کریں: /joint_states (JointState)
```

ضروریات:

- URDF سے جوائنٹ حدود کی پابندی کریں
- ہموار موشن (پوزیشنز کے درمیان انٹرپولیٹ کریں)
- 30 Hz پر جوائنٹ اسٹیٹس شائع کریں
- ہنگامی بندش تمام ویلوسٹیز کو صفر کر دیتی ہے

### 2. کی بورڈ ٹیلی آپ نوڈ

کی بورڈ ان پٹ پڑھیں اور کمانڈز بھیجیں:

| کی | ایکشن |
|-----|--------|
| `w` | شولڈر اوپر (+0.1 rad) |
| `s` | شولڈر نیچے (-0.1 rad) |
| `a` | البو اوپر (+0.1 rad) |
| `d` | البو نیچے (-0.1 rad) |
| `h` | ہوم پوزیشن (تمام صفر) |
| `e` | ہنگامی بندش |
| `q` | چھوڑیں |

### 3. ہنگامی بندش سروس

تمام موشن کو روکنے کے لیے سروس:

```python
# سروس: /emergency_stop (std_srvs/Trigger)
# تمام جوائنٹ ویلوسٹیز کو صفر پر سیٹ کرتا ہے
# کامیابی کا اسٹیٹس لوٹاتا ہے
```

### 4. لانچ فائل

پورے سسٹم کو ایک کمانڈ کے ساتھ لانچ کریں:

```bash
ros2 launch arm_controller display.launch.py
```

چاہیے شروع کرے:

- جوائنٹ کنٹرولر نوڈ
- کی بورڈ ٹیلی آپ نوڈ
- روبوٹ ماڈل کے ساتھ RViz
- robot_state_publisher

## شروع کریں

### پیکج سیٹ اپ

```bash
cd ~/ros2_ws/src
ros2 pkg create --build-type ament_python arm_controller \
    --dependencies rclpy std_msgs sensor_msgs std_srvs
mkdir -p arm_controller/urdf arm_controller/launch arm_controller/rviz
```

### URDF کاپی کریں

لیب 4 سے اپنا `simple_arm.urdf` کاپی کریں:

```bash
cp ~/ros2_ws/src/urdf_demo/urdf/simple_arm.urdf \
   ~/ros2_ws/src/arm_controller/urdf/
```

### اسٹارٹر فائلز

`starter/` ڈائریکٹری میں اسٹارٹر کوڈ استعمال کریں:

- `joint_controller.py` - جوائنٹ اسٹیٹس پبلشر
- `keyboard_teleop.py` - کی بورڈ ان پٹ ہینڈلر
- `display.launch.py` - لانچ فائل ٹیمپلیٹ

## متوقع رویہ

1. لانچ RViz میں ہوم پوزیشن پر ارم دکھاتا ہے
2. کیز دبانے سے جوائنٹس حدود کے اندر چلتے ہیں
3. موشن ہموار ہے (کوئی جرکی موومنٹس نہیں)
4. ہنگامی بندش فوراً موشن کو روک دیتی ہے
5. جوائنٹ حدود کا احترام کیا جاتا ہے (ٹرمنل میں وژول فیڈ بیک)

## جائزہ کے معیار

| معیار | پوائنٹس |
|-----------|--------|
| جوائنٹ کنٹرولر درست JointState شائع کرتا ہے | 20 |
| کی بورڈ ٹیلی آپ صحیح کمانڈز بھیجتا ہے | 20 |
| جوائنٹ حدود پر عمل کیا جاتا ہے | 15 |
| ہنگامی بندش کام کرتی ہے | 15 |
| لانچ فائل تمام نوڈز شروع کرتی ہے | 15 |
| ہموار موشن انٹرپولیشن | 10 |
| دستاویزات | 5 |
| **کل** | **100** |

## توسیعات (بونس)

1. **ٹریجکٹری ریکارڈنگ**: ارم موومنٹس ریکارڈ اور پلے بیک کریں
2. **گیم پیڈ سپورٹ**: کی بورڈ کے بجائے جوائسٹک استعمال کریں
3. **اینڈ ایفیکٹر کنٹرول**: کارٹیزین سپیس میں گریپر پوزیشن کنٹرول کریں
4. **کولیژن وارننگ**: جوائنٹ پوزیشنز سے سیلف کولیژن ڈیٹیکٹ کریں
5. **GUI**: ہر جوائنٹ کے لیے سلائیڈر کے ساتھ سادہ GUI بنائیں

## اشارے

### کی بورڈ ان پٹ پڑھنا

```python
import sys
import select
import termios
import tty

def get_key():
    """غیر مسدود کی بورڈ ریڈ."""
    settings = termios.tcgetattr(sys.stdin)
    try:
        tty.setraw(sys.stdin.fileno())
        rlist, _, _ = select.select([sys.stdin], [], [], 0.1)
        if rlist:
            key = sys.stdin.read(1)
        else:
            key = ''
    finally:
        termios.tcsetattr(sys.stdin, termios.TCSADRAIN, settings)
    return key
```

### ہموار موشن

```python
def interpolate(current, target, step=0.05):
    """ہدف کی طرف کرنٹ کو سٹیپ کی مقدار سے منتقل کریں."""
    if abs(target - current) < step:
        return target
    elif target > current:
        return current + step
    else:
        return current - step
```

### JointState شائع کرنا

```python
from sensor_msgs.msg import JointState

msg = JointState()
msg.header.stamp = self.get_clock().now().to_msg()
msg.name = ['shoulder', 'elbow']
msg.position = [shoulder_pos, elbow_pos]
msg.velocity = [0.0, 0.0]
msg.effort = [0.0, 0.0]
```

## حل

مکمل نفاذ کے لیے `solution/` ڈائریکٹری دیکھیں.

## ریفلیکشن سوالات

1. حقیقی روبوٹس کے لیے ہموار انٹرپولیشن کیوں اہم ہے؟
2. جوائنٹ حدود کی پابندی کے بغیر کیا ہوگا؟
3. آپ گریویٹی کمپن سیشن کیسے شامل کریں گے؟
4. پوزیشن اور ویلوسٹی کنٹرول میں کیا فرق ہے؟
